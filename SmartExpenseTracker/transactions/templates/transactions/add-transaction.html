{% extends 'layout.html' %} {% load static %} {% block title %}Add Transaction |
SmartTracker{% endblock %} {% block stylesheets %}
<link
  rel="stylesheet"
  href="{% static 'transactions/css/add-transaction.css'%}"
/>
<!-- Flatpickr Calendar -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
/>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css"
/>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
{% endblock %} {% block topbar %}
<h1>Add Transaction</h1>
{% endblock %} {% block content %}
<!-- Form Card -->
<section class="form-container">
  <form class="transaction-form" method="POST">
    {% csrf_token %}

    <div class="form-group">
      <label for="type">Transaction Type</label>
      <select id="type" name="type" required onchange="filterCategories()">
        <option value="">Select type</option>
        <option value="income">Income</option>
        <option value="expense">Expense</option>
      </select>
    </div>

    <div class="form-group">
      <label for="amount">Amount (â‚¹)</label>
      <input
        type="number"
        id="amount"
        name="amount"
        placeholder="Enter amount"
        min="0.01"
        step="0.01"
        required
      />
    </div>

    <div class="form-group">
      <label for="category">Category</label>
      <select id="category" name="category" required>
        <option value="">Select type first</option>
        {% for cat in expense_categories %}
        <option
          value="{{ cat.name }}"
          class="expense-cat"
          style="display: none"
        >
          {{ cat.name }}
        </option>
        {% endfor %} {% for cat in income_categories %}
        <option value="{{ cat.name }}" class="income-cat" style="display: none">
          {{ cat.name }}
        </option>
        {% endfor %}
      </select>
      <a href="{% url 'transactions:categories' %}" class="manage-link"
        >Manage categories</a
      >
    </div>

    <div class="form-group">
      <label for="date">Date</label>
      <input
        type="text"
        id="date"
        name="date"
        placeholder="Select date"
        required
        readonly
      />
    </div>

    <div class="form-group">
      <label for="description">Description</label>
      <textarea
        id="description"
        name="description"
        rows="3"
        placeholder="Optional note..."
      ></textarea>
    </div>

    <div class="form-group">
      <label for="payment">Payment Mode</label>
      <select id="payment" name="payment">
        <option>Cash</option>
        <option>UPI</option>
        <option>Debit Card</option>
        <option>Credit Card</option>
        <option>Net Banking</option>
      </select>
    </div>

    <div class="actions">
      <button type="reset" class="btn secondary">Reset</button>
      <button type="submit" class="btn primary">Save Transaction</button>
    </div>
  </form>
</section>
{% endblock %} {% block scripts %}
<script>
  // Initialize Flatpickr calendar on date input
  flatpickr("#date", {
    dateFormat: "Y-m-d",
    maxDate: "today",
    disableMobile: true,
    animate: true,
    theme: "dark",
  });

  // Filter categories based on transaction type
  function filterCategories() {
    var type = document.getElementById("type").value;
    var catSelect = document.getElementById("category");
    var options = catSelect.querySelectorAll("option");
    catSelect.value = "";

    options.forEach(function (opt) {
      if (opt.value === "") {
        opt.textContent = type ? "Select category" : "Select type first";
        opt.style.display = "";
      } else if (opt.classList.contains("expense-cat")) {
        opt.style.display = type === "expense" ? "" : "none";
      } else if (opt.classList.contains("income-cat")) {
        opt.style.display = type === "income" ? "" : "none";
      }
    });
  }

  // Client-side amount validation
  var amountInput = document.getElementById("amount");
  amountInput.addEventListener("input", function () {
    if (parseFloat(this.value) <= 0) {
      this.setCustomValidity("Amount must be greater than 0");
    } else {
      this.setCustomValidity("");
    }
  });
</script>
{% endblock %}
