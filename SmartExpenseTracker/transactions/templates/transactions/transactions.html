{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Transactions | SmartTracker</title>
  <link rel="stylesheet" href="{% static 'transactions/css/transactions.css' %}" />
</head>

<body>

  <div class="dashboard-wrapper">

    <!-- Sidebar -->
    <aside class="sidebar">
      <h2 class="brand">Smart<span>Tracker</span></h2>

      <nav class="menu">
        <a href="{% url 'dashboard:dashboard_view' %}">Dashboard</a>
        <a href="{% url 'transactions:add_transaction' %}">Add Transaction</a>
        <a href="{% url 'transactions:transactions' %}" class="active">Transactions</a>
        <a href="{% url 'accounts:logout_view' %}" class="logout">Logout</a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Topbar -->
      <header class="topbar">
        <h1>Transactions</h1>
        <div class="top-actions">
          <a href="{% url 'transactions:add_transaction' %}" class="btn primary">+ Add Transaction</a>
          <a href="{% url 'dashboard:dashboard_view' %}" class="btn secondary">← Back to Dashboard</a>
        </div>
      </header>

      <!-- Django Messages -->
      {% if messages %}
      <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Filters -->
      <section class="filters">
        <form method="get" class="filter-form">
          <div class="filter-group">
            <label>Date</label>
            <input type="month" name="month" value="{{ filter_month }}" />
          </div>

          <div class="filter-group">
            <label>Category</label>
            <select name="category">
              <option value="">All</option>
              {% if filter_category == "Food" %}<option value="Food" selected>Food</option>{% else %}<option
                value="Food">Food</option>{% endif %}
              {% if filter_category == "Travel" %}<option value="Travel" selected>Travel</option>{% else %}<option
                value="Travel">Travel</option>{% endif %}
              {% if filter_category == "Shopping" %}<option value="Shopping" selected>Shopping</option>{% else %}<option
                value="Shopping">Shopping</option>{% endif %}
              {% if filter_category == "Rent" %}<option value="Rent" selected>Rent</option>{% else %}<option
                value="Rent">Rent</option>{% endif %}
              {% if filter_category == "Entertainment" %}<option value="Entertainment" selected>Entertainment</option>{%
              else %}<option value="Entertainment">Entertainment</option>{% endif %}
              {% if filter_category == "Salary" %}<option value="Salary" selected>Salary</option>{% else %}<option
                value="Salary">Salary</option>{% endif %}
            </select>
          </div>

          <div class="filter-group">
            <label>Type</label>
            <select name="type">
              <option value="">All</option>
              {% if filter_type == "income" %}<option value="income" selected>Income</option>{% else %}<option
                value="income">Income</option>{% endif %}
              {% if filter_type == "expense" %}<option value="expense" selected>Expense</option>{% else %}<option
                value="expense">Expense</option>{% endif %}
            </select>
          </div>

          <div class="filter-group">
            <button type="submit" class="btn primary">Apply</button>
            <a href="{% url 'transactions:transactions' %}" class="btn secondary">Clear</a>
          </div>
        </form>
      </section>

      <!-- Transactions Table -->
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Description</th>
              <th>Category</th>
              <th>Amount</th>
              <th>Type</th>
              <th>Payment</th>
              <th>Actions</th>
            </tr>
          </thead>

          <tbody>
            {% for txn in transactions %}
            <tr>
              <td>{{ txn.date|date:"d M Y" }}</td>
              <td>{{ txn.description|default:"—" }}</td>
              <td>{{ txn.category }}</td>
              <td>₹{{ txn.amount|floatformat:2 }}</td>
              <td class="{% if txn.transaction_type|lower == 'income' %}income-text{% else %}expense-text{% endif %}">
                {{ txn.transaction_type }}
              </td>
              <td>{{ txn.payment_mode }}</td>
              <td>
                <a href="{% url 'transactions:edit_transaction' txn.pk %}" class="action-btn edit">Edit</a>
                <a href="{% url 'transactions:delete_transaction' txn.pk %}" class="action-btn delete"
                  onclick="return confirm('Are you sure you want to delete this transaction?')">Delete</a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="7" style="text-align: center; color: #636e72;">No transactions found.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </main>
  </div>

  <script>
    setTimeout(() => {
      document.querySelectorAll('.alert').forEach(alert => {
        alert.style.transition = 'opacity 0.5s ease';
        alert.style.opacity = '0';
        setTimeout(() => alert.remove(), 500);
      });
    }, 3000);
  </script>

</body>

</html>